#include <stdio.h>
#include <stdlib.h>
#include <linux/input.h>

// set these entries to have them printed in the message
const char* known_codes[256] = {};
#define ADD_CODE(name) known_codes[KEY_##name] = #name
void populate_known_codes() {
  ADD_CODE(ESC);
  ADD_CODE(1);
  ADD_CODE(2);
  ADD_CODE(3);
  ADD_CODE(4);
  ADD_CODE(5);
  ADD_CODE(6);
  ADD_CODE(7);
  ADD_CODE(8);
  ADD_CODE(9);
  ADD_CODE(0);
  ADD_CODE(MINUS);
  ADD_CODE(EQUAL);
  ADD_CODE(BACKSPACE);
  ADD_CODE(TAB);
  ADD_CODE(Q);
  ADD_CODE(W);
  ADD_CODE(E);
  ADD_CODE(R);
  ADD_CODE(T);
  ADD_CODE(Y);
  ADD_CODE(U);
  ADD_CODE(I);
  ADD_CODE(O);
  ADD_CODE(P);
  ADD_CODE(LEFTBRACE);
  ADD_CODE(RIGHTBRACE);
  ADD_CODE(ENTER);
  ADD_CODE(LEFTCTRL);
  ADD_CODE(A);
  ADD_CODE(S);
  ADD_CODE(D);
  ADD_CODE(F);
  ADD_CODE(G);
  ADD_CODE(H);
  ADD_CODE(J);
  ADD_CODE(K);
  ADD_CODE(L);
  ADD_CODE(SEMICOLON);
  ADD_CODE(APOSTROPHE);
  ADD_CODE(GRAVE);
  ADD_CODE(LEFTSHIFT);
  ADD_CODE(BACKSLASH);
  ADD_CODE(Z);
  ADD_CODE(X);
  ADD_CODE(C);
  ADD_CODE(V);
  ADD_CODE(B);
  ADD_CODE(N);
  ADD_CODE(M);
  ADD_CODE(COMMA);
  ADD_CODE(DOT);
  ADD_CODE(SLASH);
  ADD_CODE(RIGHTSHIFT);
  ADD_CODE(KPASTERISK);
  ADD_CODE(LEFTALT);
  ADD_CODE(SPACE);
  ADD_CODE(CAPSLOCK);
  ADD_CODE(F1);
  ADD_CODE(F2);
  ADD_CODE(F3);
  ADD_CODE(F4);
  ADD_CODE(F5);
  ADD_CODE(F6);
  ADD_CODE(F7);
  ADD_CODE(F8);
  ADD_CODE(F9);
  ADD_CODE(F10);
  ADD_CODE(NUMLOCK);
  ADD_CODE(SCROLLLOCK);
  ADD_CODE(KP7);
  ADD_CODE(KP8);
  ADD_CODE(KP9);
  ADD_CODE(KPMINUS);
  ADD_CODE(KP4);
  ADD_CODE(KP5);
  ADD_CODE(KP6);
  ADD_CODE(KPPLUS);
  ADD_CODE(KP1);
  ADD_CODE(KP2);
  ADD_CODE(KP3);
  ADD_CODE(KP0);
  ADD_CODE(KPDOT);
  ADD_CODE(ZENKAKUHANKAKU);
  ADD_CODE(102ND);
  ADD_CODE(F11);
  ADD_CODE(F12);
  ADD_CODE(RO);
  ADD_CODE(KATAKANA);
  ADD_CODE(HIRAGANA);
  ADD_CODE(HENKAN);
  ADD_CODE(KATAKANAHIRAGANA);
  ADD_CODE(MUHENKAN);
  ADD_CODE(KPJPCOMMA);
  ADD_CODE(KPENTER);
  ADD_CODE(RIGHTCTRL);
  ADD_CODE(KPSLASH);
  ADD_CODE(SYSRQ);
  ADD_CODE(RIGHTALT);
  ADD_CODE(LINEFEED);
  ADD_CODE(HOME);
  ADD_CODE(UP);
  ADD_CODE(PAGEUP);
  ADD_CODE(LEFT);
  ADD_CODE(RIGHT);
  ADD_CODE(END);
  ADD_CODE(DOWN);
  ADD_CODE(PAGEDOWN);
  ADD_CODE(INSERT);
  ADD_CODE(DELETE);
  ADD_CODE(MACRO);
  ADD_CODE(MUTE);
  ADD_CODE(VOLUMEDOWN);
  ADD_CODE(VOLUMEUP);
  ADD_CODE(POWER);
  ADD_CODE(KPEQUAL);
  ADD_CODE(KPPLUSMINUS);
  ADD_CODE(PAUSE);
  ADD_CODE(SCALE);
  ADD_CODE(KPCOMMA);
  ADD_CODE(HANGEUL);
  ADD_CODE(HANGUEL);
  ADD_CODE(HANJA);
  ADD_CODE(YEN);
  ADD_CODE(LEFTMETA);
  ADD_CODE(RIGHTMETA);
  ADD_CODE(COMPOSE);
  ADD_CODE(STOP);
  ADD_CODE(AGAIN);
  ADD_CODE(PROPS);
  ADD_CODE(UNDO);
  ADD_CODE(FRONT);
  ADD_CODE(COPY);
  ADD_CODE(OPEN);
  ADD_CODE(PASTE);
  ADD_CODE(FIND);
  ADD_CODE(CUT);
  ADD_CODE(HELP);
  ADD_CODE(MENU);
  ADD_CODE(CALC);
  ADD_CODE(SETUP);
  ADD_CODE(SLEEP);
  ADD_CODE(WAKEUP);
  ADD_CODE(FILE);
  ADD_CODE(SENDFILE);
  ADD_CODE(DELETEFILE);
  ADD_CODE(XFER);
  ADD_CODE(PROG1);
  ADD_CODE(PROG2);
  ADD_CODE(WWW);
  ADD_CODE(MSDOS);
  ADD_CODE(COFFEE);
  ADD_CODE(SCREENLOCK);
  ADD_CODE(ROTATE_DISPLAY);
  ADD_CODE(DIRECTION);
  ADD_CODE(CYCLEWINDOWS);
  ADD_CODE(MAIL);
  ADD_CODE(BOOKMARKS);
  ADD_CODE(COMPUTER);
  ADD_CODE(BACK);
  ADD_CODE(FORWARD);
  ADD_CODE(CLOSECD);
  ADD_CODE(EJECTCD);
  ADD_CODE(EJECTCLOSECD);
  ADD_CODE(NEXTSONG);
  ADD_CODE(PLAYPAUSE);
  ADD_CODE(PREVIOUSSONG);
  ADD_CODE(STOPCD);
  ADD_CODE(RECORD);
  ADD_CODE(REWIND);
  ADD_CODE(PHONE);
  ADD_CODE(ISO);
  ADD_CODE(CONFIG);
  ADD_CODE(HOMEPAGE);
  ADD_CODE(REFRESH);
  ADD_CODE(EXIT);
  ADD_CODE(MOVE);
  ADD_CODE(EDIT);
  ADD_CODE(SCROLLUP);
  ADD_CODE(SCROLLDOWN);
  ADD_CODE(KPLEFTPAREN);
  ADD_CODE(KPRIGHTPAREN);
  ADD_CODE(NEW);
  ADD_CODE(REDO);
  ADD_CODE(F13);
  ADD_CODE(F14);
  ADD_CODE(F15);
  ADD_CODE(F16);
  ADD_CODE(F17);
  ADD_CODE(F18);
  ADD_CODE(F19);
  ADD_CODE(F20);
  ADD_CODE(F21);
  ADD_CODE(F22);
  ADD_CODE(F23);
  ADD_CODE(F24);
  ADD_CODE(PLAYCD);
  ADD_CODE(PAUSECD);
  ADD_CODE(PROG3);
  ADD_CODE(PROG4);
  ADD_CODE(DASHBOARD);
  ADD_CODE(SUSPEND);
  ADD_CODE(CLOSE);
  ADD_CODE(PLAY);
  ADD_CODE(FASTFORWARD);
  ADD_CODE(BASSBOOST);
  ADD_CODE(PRINT);
  ADD_CODE(HP);
  ADD_CODE(CAMERA);
  ADD_CODE(SOUND);
  ADD_CODE(QUESTION);
  ADD_CODE(EMAIL);
  ADD_CODE(CHAT);
  ADD_CODE(SEARCH);
  ADD_CODE(CONNECT);
  ADD_CODE(FINANCE);
  ADD_CODE(SPORT);
  ADD_CODE(SHOP);
  ADD_CODE(ALTERASE);
  ADD_CODE(CANCEL);
  ADD_CODE(BRIGHTNESSDOWN);
  ADD_CODE(BRIGHTNESSUP);
  ADD_CODE(MEDIA);
  ADD_CODE(SWITCHVIDEOMODE);
  ADD_CODE(KBDILLUMTOGGLE);
  ADD_CODE(KBDILLUMDOWN);
  ADD_CODE(KBDILLUMUP);
  ADD_CODE(SEND);
  ADD_CODE(REPLY);
  ADD_CODE(FORWARDMAIL);
  ADD_CODE(SAVE);
  ADD_CODE(DOCUMENTS);
  ADD_CODE(BATTERY);
  ADD_CODE(BLUETOOTH);
  ADD_CODE(WLAN);
  ADD_CODE(UWB);
  ADD_CODE(UNKNOWN);
  ADD_CODE(VIDEO_NEXT);
  ADD_CODE(VIDEO_PREV);
  ADD_CODE(BRIGHTNESS_CYCLE);
  ADD_CODE(BRIGHTNESS_AUTO);
  ADD_CODE(BRIGHTNESS_ZERO);
  ADD_CODE(DISPLAY_OFF);
  ADD_CODE(WWAN);
  ADD_CODE(WIMAX);
  ADD_CODE(RFKILL);
  ADD_CODE(MICMUTE);
}

// set these entries to have them printed in the message
const char* known_types[EV_MAX] = {};
#define ADD_TYPE(name) known_types[EV_##name] = #name
void populate_known_types() {
  ADD_TYPE(SYN);
  ADD_TYPE(KEY);
  ADD_TYPE(REL);
  ADD_TYPE(ABS);
  ADD_TYPE(MSC);
  ADD_TYPE(SW);
  ADD_TYPE(LED);
  ADD_TYPE(SND);
  ADD_TYPE(REP);
  ADD_TYPE(FF);
  ADD_TYPE(PWR);
  ADD_TYPE(FF_STATUS);
}

int main(void) {
  // turn off buffering of standard in and out
  setbuf(stdin, NULL);
  setbuf(stdout, NULL);

  // populate some known codes
  populate_known_codes();
  populate_known_types();

  // read from stdin, and print readable output
  struct input_event event;
  while (fread(&event, sizeof(event), 1, stdin) == 1) {
    printf("type: %4d %-10s   code: %4d %-10s\n",
        event.type, known_types[event.type] ? known_types[event.type] : "?",
        event.code, event.type != EV_KEY    ? "" :
                    known_codes[event.code] ? known_codes[event.code] : "?");
  }

  return 0;
}
